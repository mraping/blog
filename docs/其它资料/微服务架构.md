# 微服务架构
将系统拆分成了一个个的服务单元，各单元应用间通过服务注册与订阅的方式互相依赖。
由于每个单元都在不同的进程中运行，依赖通过远程调用的方式执行。
## 微服务的特点
微服务架构是一种架构模式，满足以下的五点基本要求：</br>
* 一系列小服务的组合(微服务的粒度按照业务来进行拆分)
* 可以单独的运行(任何的微服务都是一个独立的进程,从开发、测试、上线、运维都可以独立的进行)
* 围绕业务建模
* 轻量级的通信(可以进行独立的部署)
    * 模块间的通信是与语言无关的
    * 模块间的通信是与平台无关的
* 去中心化的管理(对任何语言、平台是没有依赖的)

## 微服务的使用原因
* 系统高可用
* 系统高扩展性
* 快速迭代
* 持续交付

## 微服务的设计
* 整体设计
    * 水平分层
    * 垂直业务拆分
* 每层设计
    * 微服务-业务单元垂直拆分
    * 无状态化
    * 独立进程、部署、运维
* 高可用
    * 冗余(任何的单点都是不可靠的，因此要部署多份)
    * 自动恢复

## 微服务架构的分层(从上往下)
* 微服务网关层
    * 客户端与服务器的第一层接入，负责维护海量的连接
    * 对用户的请求和身份进行校验(对登录进行校验，session的管理)
    * 对请求的转发，(微服务的发现，转发到微服务聚合层，网关层不会做任何业务的处理)
    * 负载均衡
* 微服务聚合层(对业务逻辑的处理，在这一层有多个被垂直拆分的服务)
* 微服务原子层(提供每一个微服务CURD的一些接口)
* 微服务数据层(每一个微服务的数据单独存在一个数据库里)

客户端与网关层通信使用HTTP、HTTPS</br>
微服务网关层与聚合层及聚合层到原子层使用RPC进行通信(基于TCP的RCP可以解决HTTP无法提供长连接的问题，提高通信效率)
## 微服务的通信协议
> 基于微服务的分布式应用是运行在多台机器上的；一般来说，每个服务实例都是一个进程。因此服务之间的交互必须通过进程间通信（IPC）来实现。
  而对于消息格式的选择，可以看到在使用RestAPI接口的时候，更多的是采用了Json消息格式而非XML，对于SOAPWebService则更多采用了XML消息格式。
  如果采用Thrift则还可以采用二进制消息格式以提升性能。
* 通信协议-轻量级通信协议
    * REST(HTTP)
    * HAL(REST)
    * RPC(Thrift、gRpc、dubbo)
    * 消息队列
* 微服务的通信协议选择
    * 微服务网关层:REST API
    * 微服务聚合层、原子层:RPC
## 服务注册/发现
* 微服务注册中心
    * Host
    * Port
    * Config等
* 微服务发现
    * 下游发现
    * 负载均衡    
## 微服务的柔性可用
目标:保证核心服务可用；非核心服务弱可用，甚至不可用</br>
* 系统降级
    * 拒绝部分请求(用的较多)
        * 拒绝部分老请求
            * 减轻微服务请求处理数量
            * 确保“新”请求正常处理
            * RPC队列方式(请求入队、出队时间处理请求时，检查请求在队列请求时间，超过一定时间的直接丢弃)
        * 优先级请求方式(非核心请求直接丢弃)
        * 随机拒绝方式(随机丢弃一部分请求)
    * 关闭部分服务(如天猫退货服务在双十一当天暂时关闭)
* 数据层降级
    * 更新请求
        * 持久化到消息队列
        * 只更新缓存
    * 读请求
        * 读缓存
    * 数据补齐
        * 消息队列->数据库

## 微服务的服务治理
监控机器资源和进程状态
    
## 微服务技术的优点：
   独立开发、独立部署、独立发布，去中心化管理，支持高并发高可用，支持丰富技术栈，企业可以根据需要灵活技术选型
## Docker与微服务
   容器和微服务相辅相成，两大技术成熟的时间点非常契合。容器技术的成熟为微服务提供了得天独厚的客观条件。轻量化的容器是微服务的最佳运行环境，微服务应用只有在容器环境下才能保障运维效率的提升。同时，微服务应用架构对外在组件的管理会变得困难，需要用容器平台去管理中间件，才能发挥出更大价值。

## 微服务化体系：
   微服务化体系，包括开发框架、以及周边配套工具链和组件，比如服务注册、服务发现、API网关、负载均衡、服务治理、配置中心、安全管理、与容器的结合、监控管理等等。
