百亿交易额背后的缓存架构-高并发分布式

## 数据库性能
- TPS:Transaction Per Second,数据库每秒执行的事
务数，以commit为准。
- QPS:Query Per Second,数据库每秒执行的SQL数
(含insert、select、 update、 delete等) 。

### 数据库查询缓存

- 缓存整个sql（缓存性能差）
- mysql5.7不推介使用缓存，mysql8.0直接抛弃
- 默认不开启数据库缓存
- 查看查询缓存状态：
```
SHOW VARIABLES LIKE '8query_cache8' ;
```

### 缓存性能衡量指标：
- 命中率
- 维护成本

## 推介使用应用层缓存
Java应用会读数据库，把数据缓存起来，是本地缓存（如Map等），不同的进程无法访问，也不好维护。因此出现了分布式缓存中间件（Redis、Memcached）

比较项 | 单机缓存 | 分布式缓存中间件
---|---|---
运行方式 | 嵌入单一进程内部的存储区域| 独立启动的进程
交互方式| 通过内存直接访问 | 通过网络进行交互
读取速度 | 纳秒级别 | 毫秒级别
实现 | HashMap、Guava、 Ehcache.. | Redis、Memcached..
优缺点|速度最快。只能单进程使用，同样的数据存储到速度快，多进程共用，节省内存占|不同的进程，导致缓存维护成本高内存占用率高用和缓存维护成本


## redis

基于内存亦可持久化的日志型、Key-Value数据库，每秒处理请求几十万(常用来做数据缓存)


入门阶段| 进阶 | 实战应用
---|---|---
Redis概念命令及简单使用，多种持久化的配置，使用主从实现读写分离，结合Spring或其他客户端搭建哨兵实现高可用发布订阅等机制的使用 | 主从数据同步延迟问题，不同数据类型的应用场景，持久化过程中消息丢失，Cluster集群及性能分析，哨兵高可用原理深度剖析，不同持久化方式的优缺点 | 亿级数据存储、缓存击穿/雪崩解决方案、电商系统超时订单实现、Redis高性能原理分析、分布式订单号生成、基于redis实现的分布式锁

## 代理服务器缓存
- JAVA应用程序请求nginx，Nginx内无缓存，则访问后端JAVA程序

- 会在ngnix的缓存文件夹下面生成缓存文件

- 访问的是nginx，nginx是不做处理的，收到请求之后会转发给java服务器

- nginx进程：nginx可配置工作进程数，另外还有一个监控进程
